---
title: "Introduction to Monte Carlo Simulation"
author: "Le Wang"
header-includes:
  - \usepackage{tikz}
date: "`r Sys.Date()`"
output: beamer_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Road Map

1. The Purpose of Monte Carlo Simulation and The Very Brief Account of Its Historical Development

2. (Skip) Philosophical Debate over Randomness (Frequency vs. Subjective)

3. Randomness in Stata

    1. Inverse Transform Method (Reproduction Property)
    2. One-dimension Monte Carlo Integration
    3. Simulate a Fair Coin in Stata
    4. Simulate an Unfair coin in Stata
    5. How shoud we play craps?


## Original purpose:


Find approximate solutions to certain mathematical equations.

\pause
\bigskip

In 1947, scientists at the Rand Corporation were unable to solve their problem (related to nuclear weapon projects) using conventional, deterministic mathematical methods. They had the idea of using random experiments, which involves a large table of random digits.  

\pause
\bigskip
$\implies$ Development of ways to generate random data. Being secret, their work required a code name: Monte Carlo!

---

![Monte Carlo Casion, Monaco](figures/Monte-Carlo_casino.png)

[Ulam's uncle would borrow money from relatives to gamble. Wikipedia page](https://en.wikipedia.org/wiki/Monte_Carlo_method )

---

![A Million Random Digits in 1955](figures/rand-random_digits_cover.png)

---

![A Million Random Digits in 1955](figures/rand-random_digits_inside.png)

---

**Monte Carlo Simulation** : generating random data (samples) from a probability distribution.

\bigskip

**Creation of Uncertainty/Randomness**


## Philosophical debate about the interpretation of randomness

Interpretation of Randomness: **Frequency** vs **Subjective**

\bigskip

**Frequency Interpretation:** You judge a sample by the way it turns out.

\bigskip

**Subjective Interpretation:** You judge a sample by the way it is produced. We know how it is produced (on our computer) in our computer!

---

Algorithms to produce randomness have been refined over the years. 


We now understand that truly random events do occur on the atomic level. Today, cutting-edge quantum generators produce truly random numbers from the toss of Nature's perfect quantum dice. 

---

**Randomness in Stata**:

\bigskip

We safely leave this philosophical debate and practical examination of randomness behind us. Assume that it has been done correctly for our purpose.

\bigskip

When we say that a random variable in Stata \emph{simulates} (or represents) some unknown quantity in real life, we mean that

\bigskip

Any event for this simulated random variable is, from the perspective of our current information and beliefs, just as likely as the same event for the real unknown quantity. 


--- 

For example,

\bigskip

If the unknown outcome of a coin toss has a probability $0.50$ of equaling 1 (or tails), then the random variable in R should also have probability $.50$ of equaling 1 after the next recalculation of the computer. 


## Stata Resources


1. [How to generate random numbers in Stata (click here)](https://blog.stata.com/2016/03/10/how-to-generate-random-numbers-in-stata/) 

2. Bill Gould's blog posts on Using Stata's random-number generators


## Stata Implementation

**Reproduction Property** Let $X$ be a real-valued random variable with distribution function $F$, and let $U$ be uniformly distributed between zero and one. Then,

$$
F^{-1}(U) \sim F_X 
$$

---

![](figures/stata_coming.jpeg)

## Example of Inverse Transform Method: Exponential Distribution



$$
\begin{aligned}
f(x;\lambda) & =  \lambda e^{-\lambda x}, \quad x\geq 0 \\
F(x;\lambda) & =  (1-e^{-\lambda x}), \quad x \geq 0 \\
F^{-1}(x; \lambda) & = \frac{-\ln(1-u)}{\lambda}, \quad 0 \leq u \leq 1
\end{aligned}
$$


\bigskip

Stata Example: `\Stata\_example\_monte\_carlo01.do`


## Application II: One-Dimension Monte Carlo Integration


Suppose that we want to compute

$$
  \theta = \int^1_0 g(x) dx
$$

We cannot compute $\theta$ analytically, we can use numerical methods. The key is to realize that this expression is nothing but 

$$
\begin{aligned}
  \theta & =  \int^1_0 g(x) \cdot 1 \cdot dx \\
         & =  \mathbb{E}[g(x)]
\end{aligned}
$$


Remember that $1$ is the density function of the standard uniform.

$$
\mathbb{E}[g(x)] = \int g(x) f(x) dx
$$


---

$$
\begin{aligned}
  \theta & =  \int^1_0 g(x) \cdot 1 \cdot dx \\
         & =  \mathbb{E}[g(x)]
\end{aligned}
$$


---

If we know that 
$$
\begin{aligned}
  \theta & =  \int^1_0 g(x) dx \\
         & =  \mathbb{E}[g(U)] \quad U \sim U(0,1)
\end{aligned}
$$

We can do the following

\pause
    1. Generate a random set of values ($U_1,U_2, U_3, \dots, U_N$) distributed from $U(0,1)$ and independent
    
\pause
    2. Generate $g(U_1), g(U_2), \dots g(U_N)$
    
\pause
    3. Estimate $\theta$ with 
      $$
        \widehat{\theta_n} = \frac{g(U_1)+g(U_2)+\dots+g(U_N)}{N}
      $$
      
---

**Example:** Suppose that we wish to estimate 

$$\int^1_0 x^3 dx = \frac{1}{4}=.25$$

\bigskip

**Stata example**: `Stata\_example\_monte\_carlo02.do`

## Extensions

You can extend this to obtain integration over a suppose different from [$0,1$]. For example,
    
$$    
    \begin{aligned}
    \theta & =  \int^3_1 (x^2 + x) dx \\
           & =  2 \cdot \int^3_1 (x^2+x) \frac{1}{2} dx \\
           & =  2 \mathbb{E}[X^2 + X]
    \end{aligned}
$$

Note that $X$ is distributed from $U(1,3)$ (Uniform distribution with support [$1,3$]) whose density is $\frac{1}{3-2}=\frac{1}{2}$. 
    
--- 

You can also simulate discrete variables based on the standard uniform distribution. 



Simulating uniformly distributed variables (other than standard uniform)

  1. Draw directly using Stata built-in command \texttt{runiform(min=,max=)}
  2. Or, draw indirectly using standard uniform first and then manipulate it (with addition and multiplication) into a uniform distribution with different support. In your homework, you will be asked to try this method.


**Stata example**: `Stata\_example\_monte\_carlo02.do`

## Application III: Simulate Coin Toss and Dice Rolling

**Stata example**: 


    1.`Stata_example_monte_carlo03.do` 

    2. `Stata_example_monte_carlo04.do`

